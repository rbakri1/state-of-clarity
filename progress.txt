# Ralph Progress Log
Started: Wed 14 Jan 2026 22:26:06 +04

## Codebase Patterns
- Agent persona files export string constants for system prompts (see specialist-personas.ts and accountability-personas.ts for patterns)
- Types for accountability features are in lib/types/accountability.ts
- Use @langchain/langgraph for state machine orchestration (already in dependencies)
---

## 2026-01-14 - US-001
Thread: https://ampcode.com/threads/T-019bbdc2-051a-725c-b4ad-e2b2b36254ba
- Created centralized system prompts for all 5 accountability tracker agents
- File created: lib/agents/accountability-personas.ts
- Prompts: ENTITY_CLASSIFICATION_PROMPT (99 words), UK_PROFILE_RESEARCH_PROMPT (411 words), CORRUPTION_ANALYSIS_PROMPT (362 words), ACTION_LIST_GENERATION_PROMPT (329 words)
- All prompts use conditional language and include ethical framing
- Corruption prompt mandates innocentExplanations for every scenario
- **Learnings for future iterations:**
  - Existing test files have pre-existing type errors (unrelated to this work)
  - Follow the pattern in specialist-personas.ts for persona exports
---

## 2026-01-14 - US-002
Thread: https://ampcode.com/threads/T-019bbdc4-9153-750e-b5d4-d9453d3a6e07
- Created LangGraph state annotation and types for accountability tracker pipeline
- File created: lib/agents/accountability-tracker-orchestrator.ts
- Defined AccountabilityState interface with all required fields
- Created AccountabilityStateAnnotation using Annotation.Root from @langchain/langgraph
- Added concatenation reducer for completedSteps array
- Added replace reducers for object fields (profileData, corruptionScenarios, actionItems, etc.)
- **Learnings for future iterations:**
  - Follow the existing pattern in langgraph-orchestrator.ts for state annotations
  - Use `reducer: (prev, next) => next ?? prev` for fields that should be replaced
  - Use `reducer: (prev, next) => [...prev, ...next]` for arrays that accumulate
---

## 2026-01-14 - US-003
Thread: https://ampcode.com/threads/T-019bbdc6-5ba8-7788-a930-7dbb9f38d2fe
- Implemented entity classification agent for individual/organization classification
- File created: lib/agents/entity-classification-agent.ts
- Uses Claude Haiku (claude-haiku-4-5-20251001) for cost efficiency
- Checks for organization suffixes (Ltd, Limited, PLC, etc.) before calling LLM
- Parses JSON response with entityType, confidence, reasoning
- Defaults to 'individual' if response is ambiguous or unparseable
- Returns updated state with entityType and adds 'entity_classification' to completedSteps
- **Learnings for future iterations:**
  - Use claude-haiku-4-5-20251001 (not claude-3-haiku-20240307) per codebase convention
  - Follow question-classifier.ts pattern for Anthropic API calls and JSON parsing
  - Pre-existing test file type errors don't block implementation work
---

## 2026-01-14 - US-004
Thread: https://ampcode.com/threads/T-019bbdc8-3716-723c-9c15-3476d124107e
- Implemented UK profile research agent for fetching and synthesizing UK public data
- File created: lib/agents/uk-profile-research-agent.ts
- Calls fetchUKPublicData() to fetch from 5 UK public data sources in parallel
- Uses Claude Sonnet (claude-sonnet-4-20250514) for profile synthesis (not Opus as it's not available)
- Adds each source to investigation via addInvestigationSource()
- Creates sparse profile when no data is available (graceful degradation)
- Returns profileData and adds 'uk_profile_research' to completedSteps
- **Learnings for future iterations:**
  - Use claude-sonnet-4-20250514 instead of claude-3-opus-20240229 (per codebase convention)
  - Follow entity-classification-agent.ts pattern for JSON extraction and error handling
  - Pre-existing test file type errors don't block implementation work
---
