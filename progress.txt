# Ralph Progress Log
Started: Wed 14 Jan 2026 21:28:27 +04

## Codebase Patterns
- Services go in `/lib/services/` with JSDoc comments on all exported functions
- Use types from `/lib/types/accountability.ts` for accountability features
- Handle 404 responses gracefully by returning empty arrays (not throwing)
- Implement retry logic with exponential backoff (1s/2s/4s delays, 3 attempts)
- Use `verificationStatus: "verified"` for official API sources, `"unverified"` for web scraped data

---

## 2026-01-14 21:30 - US-001
Thread: https://ampcode.com/threads/T-019bbd8d-3be0-707c-bf81-b961cf91c967
- Created Companies House API service file at `/lib/services/companies-house-api.ts`
- Added COMPANIES_HOUSE_API_KEY to .env.example
- Implemented:
  - `getCompaniesHouseAuthHeader()` - Basic Auth header generation
  - `searchOfficers(name)` - Search officers endpoint
  - `getOfficerAppointments(officerId)` - Get appointments for an officer
  - `fetchCompaniesHouseProfile(entityName)` - Full profile with retry logic
- All functions have JSDoc comments
- 404 responses return empty arrays (graceful handling)
- **Learnings for future iterations:**
  - Pre-existing test errors in `__tests__/` directory - not blocking commits
  - Types `CompanyRecord` and `InvestigationSource` already defined in accountability.ts
  - Companies House API uses Basic Auth with API key as username and empty password
---

## 2026-01-14 21:32 - US-002
Thread: https://ampcode.com/threads/T-019bbd8f-6ea9-749c-9e2e-c8902203291f
- US-002 was already implemented as part of US-001 commit
- `fetchCompaniesHouseProfile(entityName)` function verified at lines 144-237 in companies-house-api.ts
- Returns `{ records: CompanyRecord[]; sources: InvestigationSource[] }`
- Has retry logic with exponential backoff (3 attempts, 1s/2s/4s delays)
- Creates sources with `sourceType: "companies_house"` and `verificationStatus: "verified"`
- Typecheck passes
---

## 2026-01-14 21:35 - US-003
Thread: https://ampcode.com/threads/T-019bbd8f-6ea9-749c-9e2e-c8902203291f
- Created `/lib/parsers/charity-commission-parser.ts`
- Implemented `fetchCharityCommissionData(entityName)` function
- Uses Tavily search with query: `"[name]" trustee site:register-of-charities.charitycommission.gov.uk`
- Parses charity numbers from URLs using regId and /charity/ patterns
- Returns `{ records: CharityRecord[]; sources: InvestigationSource[] }`
- Sources have `verificationStatus: "unverified"` (web scraped data)
- Typecheck passes
- **Learnings for future iterations:**
  - Created `/lib/parsers/` directory for Tavily-based parsers
  - Tavily pattern: use `safeAICall` wrapper for error handling
  - Use `include_domains` param to limit search to specific sites
---

## 2026-01-14 21:34 - US-004
Thread: https://ampcode.com/threads/T-019bbd91-fe11-75ad-8463-f3eb956e2bf3
- Created `/lib/parsers/parliament-parser.ts`
- Implemented `fetchRegisterOfInterests(entityName)` function
- Uses Tavily search with query: `"[name]" "register of interests" site:parliament.uk`
- Parses interest categories: Employment, Donations, Land, Shareholdings
- Extracts monetary values with Â£ symbol patterns
- Returns `{ records: InterestDeclaration[]; sources: InvestigationSource[] }`
- Sources have `verificationStatus: "unverified"` (web scraped data)
- Returns empty arrays if no results (graceful handling for non-MPs)
- Typecheck passes
- **Learnings for future iterations:**
  - Use typed category literals (e.g., `type InterestCategory = "Employment" | ...`) for type safety
  - Extract dates from content with regex, fallback to current date
  - Deduplicate results using `Set<string>` on URLs
---
