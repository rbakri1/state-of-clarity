# Ralph Progress Log
Started: Sun 11 Jan 2026 23:57:46 +04

## Codebase Patterns
- Use `requireAuth()` from lib/supabase/client.ts to protect authenticated endpoints
- Use `createServiceRoleClient()` for admin operations that bypass RLS (e.g., deleting users)
- Database schema uses ON DELETE CASCADE for user data (profiles, saved_briefs, reading_history)
- Database schema uses ON DELETE SET NULL for content anonymization (briefs, feedback, brief_jobs)
- Export endpoint was not yet implemented despite Epic 5.1 being marked complete
- Supabase joins work with .select("column, table(columns)") syntax
- Cookie consent uses JSON format in localStorage for audit trail: `{value, timestamp}`
- Use `hasAcceptedCookies()` from cookie-consent-banner.tsx to check before loading analytics
- Client components in Next.js need "use client" directive at top
- Duplicate files with " 2" suffix can cause build failures - clean them up before running builds
---

## Sun 12 Jan 2026 - US-001
Thread: https://ampcode.com/threads/T-019baea4-e766-7534-a4e4-67322408fcac
- Created privacy policy page at /app/privacy/page.tsx
- Page includes all required sections: What data we collect, How we use it, Third parties (Supabase, Stripe, Vercel), User rights (export, delete), Contact info
- Footer already contained link to /privacy
- Build passes successfully
- **Learnings for future iterations:**
  - Privacy page already existed in untracked files from previous work
  - Footer in app/page.tsx already has Legal section with privacy link
---

## Mon 12 Jan 2026 - US-002
Thread: https://ampcode.com/threads/T-019baea6-cb9b-72dd-8360-3bfcad0551c2
- Created terms of service page at /app/terms/page.tsx
- Page includes sections: Acceptance of Terms, User Responsibilities, Intellectual Property, Limitation of Liability, Termination, Dispute Resolution, Contact Us
- Uses simple, readable language (not legalese)
- Added Terms of Service link to footer in app/page.tsx
- Cleaned up duplicate files (brief-service 2.ts, safe-query 2.ts) that were causing build failures
- Build passes successfully
- Browser verification passed: title, sections, and footer link confirmed
- **Learnings for future iterations:**
  - Duplicate files with " 2" suffix can cause build failures - clean them up before running builds
  - Follow privacy page structure/styling for consistency on legal pages
---

## Mon 12 Jan 2026 - US-003
Thread: https://ampcode.com/threads/T-019baeab-276a-764f-945b-d063e853a5c5
- Created cookie consent banner component at /components/cookie-consent-banner.tsx
- Banner appears at bottom of screen with fixed positioning (z-50)
- Includes message about cookies (analytics, functionality)
- Accept and Decline buttons with proper styling
- Links to privacy policy from banner
- Added CookieConsentBanner to root layout.tsx
- Typecheck passes
- **Learnings for future iterations:**
  - Client components in Next.js need "use client" directive at top
  - This codebase does not have a /components folder - had to create it
  - Use localStorage for client-side persistence
---

## Mon 12 Jan 2026 - US-004
Thread: https://ampcode.com/threads/T-019baeb6-da35-7169-884c-96e7236d7460
- Fixed cookie consent persistence to properly store and retrieve JSON format
- Consent stored as JSON object: {value: "accepted"|"declined", timestamp: ISO string}
- Added `getStoredConsent()` that parses JSON and falls back to legacy string format
- Added exported utilities: `getConsentStatus()` and `hasAcceptedCookies()` for other components
- Banner correctly hidden when consent already exists in localStorage
- Build passes successfully
- **Learnings for future iterations:**
  - Cookie consent uses JSON format in localStorage for audit trail: `{value, timestamp}`
  - Use `hasAcceptedCookies()` from cookie-consent-banner.tsx to check before loading analytics
---

## Mon 12 Jan 2026 - US-005
Thread: https://ampcode.com/threads/T-019baeb8-6e29-7708-a9b6-578af2482ca9
- Created /app/api/profile/export/route.ts endpoint for GDPR data export
- Export includes: user auth info, profile, briefs created, saved briefs, reading history, feedback, brief jobs
- Export returns downloadable JSON file with timestamped filename
- Created comprehensive /docs/GDPR.md documentation covering:
  - What personal data we collect and why
  - Data retention policy
  - Third-party data processors (Supabase, Vercel, Stripe)
  - User rights (export, rectification, deletion)
  - How to handle data requests
- Build passes successfully
- **Learnings for future iterations:**
  - Export endpoint was not yet implemented despite Epic 5.1 being marked complete
  - Use requireAuth() from lib/supabase/client.ts to protect authenticated endpoints
  - Supabase joins work with .select("column, table(columns)") syntax
---

## Mon 12 Jan 2026 - US-006
Thread: https://ampcode.com/threads/T-019baebc-3b4a-76a9-9a24-af0adcd27d10
- Created /app/api/profile/delete/route.ts endpoint for GDPR account deletion
- Endpoint requires confirmation: POST with {"confirmation": "DELETE"}
- Uses createServiceRoleClient() to call Supabase Admin API deleteUser
- Audited database schema - cascades properly configured:
  - ON DELETE CASCADE: profiles, saved_briefs, reading_history
  - ON DELETE SET NULL: briefs, feedback, brief_jobs (anonymization)
- Updated /docs/GDPR.md with detailed deletion process and API endpoint
- Build passes successfully
- **Learnings for future iterations:**
  - Delete endpoint did not exist - had to create from scratch
  - Supabase admin.deleteUser() triggers all database cascades/SET NULL automatically
  - Confirmation pattern: require exact string match before destructive operations
---
