# Ralph Progress Log
Started: Sun 11 Jan 2026 17:31:07 +04

## Codebase Patterns
- Use lucide-react for icons (AlertTriangle, ChevronDown, ChevronUp, RefreshCw)
- Error components use red-50/red-950 bg with red-200/red-800 borders for dark mode support
- Use "use client" directive for components with useState or interactivity
- No cn utility - use template literals for className concatenation: `${base} ${custom}`
- Use Tailwind animate-pulse for skeleton/loading states
- Use `safeQuery` from lib/supabase/safe-query.ts for Supabase queries with error handling
- Supabase query functions use PromiseLike (not Promise) for type compatibility with PostgrestBuilder
---

## 2026-01-11 17:35 - US-009
Thread: https://ampcode.com/threads/T-019bad40-e1da-729c-9c27-b468fd383615
- Implemented ErrorMessage component at /app/components/ErrorMessage.tsx
- Props: title, message, details (optional), onRetry (optional)
- Friendly AlertTriangle icon, collapsible technical details section
- "Try again" button only shows when onRetry callback provided
- Files changed: app/components/ErrorMessage.tsx
- **Learnings for future iterations:**
  - Follow existing ErrorBoundary styling patterns for consistency
  - Use collapsible details pattern with useState for show/hide toggle
---

## 2026-01-11 18:10 - US-010
Thread: https://ampcode.com/threads/T-019bad42-e43c-7506-81e2-a86d988af9fb
- Created error message mapping at /lib/errors/error-messages.ts
- Maps all error codes from api-error.ts plus NETWORK_ERROR and UNKNOWN fallback
- FriendlyError interface with title and message fields
- Two helper functions: getFriendlyError(code) and getErrorByStatusCode(statusCode)
- Files changed: lib/errors/error-messages.ts
- **Learnings for future iterations:**
  - Reuse ErrorCodes from api-error.ts for type safety
  - Include UNKNOWN as default fallback for any unmapped error codes
---

## 2026-01-11 18:45 - US-011
Thread: https://ampcode.com/threads/T-019bad44-b2ad-7018-889b-a26a076e8ec9
- Created Skeleton component at /app/components/Skeleton.tsx
- Variants: text, paragraph, card, avatar, button
- Uses Tailwind animate-pulse for subtle loading animation
- Accepts className prop for custom sizing
- Uses aria-hidden="true" for accessibility
- Files changed: app/components/Skeleton.tsx
- **Learnings for future iterations:**
  - Codebase doesn't have a cn utility - use template literals for class concatenation
  - Tailwind's animate-pulse works well for skeleton loading states
  - Use gray-200/gray-700 for light/dark mode skeleton backgrounds
---

## 2026-01-11 19:15 - US-012
Thread: https://ampcode.com/threads/T-019bad48-5423-748c-98b5-e20682f37d5c
- Created loading skeleton for brief page at /app/brief/[id]/loading.tsx
- Skeletons for: header (title, clarity score, tags), reading level selector, summary, structured data sections, narrative, sources grid, feedback section
- Matches BriefPageClient.tsx layout structure exactly
- Uses existing Skeleton component with variants: text, paragraph, card, button
- Files changed: app/brief/[id]/loading.tsx
- **Learnings for future iterations:**
  - Next.js app router loading.tsx files are automatically used during Suspense boundaries
  - Match skeleton layout closely to actual page to minimize layout shift
  - Use Skeleton variant="card" for grid items like sources
---

## 2026-01-11 19:55 - US-013
Thread: https://ampcode.com/threads/T-019bad4d-f67c-7471-bc50-ba184c54dea2
- Created homepage loading skeleton at /app/loading.tsx
- Skeletons for: header, hero section, search input, 3 feature cards, 3 showcase brief cards, footer
- Matches page.tsx layout structure exactly
- Uses existing Skeleton component with appropriate variants and sizing
- Files changed: app/loading.tsx
- **Learnings for future iterations:**
  - Homepage has 5 main sections: header, hero, features grid, showcase briefs grid, footer
  - Use Array.from({ length: N }) for generating repeated skeleton elements in grids
  - Match skeleton dimensions to actual content (e.g., h-12 for titles, h-6 for subtitles)
---

## 2026-01-11 20:30 - US-014
Thread: https://ampcode.com/threads/T-019bad51-20fb-7411-8faf-b0708ffd286a
- Created safeQuery utility at /lib/supabase/safe-query.ts
- Wraps Supabase queries with try-catch, logs to Sentry with query context
- Returns SafeQueryResult with data, error, and isConnectionError flag
- Detects connection errors by error codes and message keywords
- Updated getBriefById in brief-service.ts to use safeQuery
- Updated profile API route to use safeQuery for all database queries
- Files changed: lib/supabase/safe-query.ts, lib/services/brief-service.ts, app/api/profile/route.ts
- **Learnings for future iterations:**
  - Use PromiseLike instead of Promise for Supabase query function types (PostgrestBuilder compatibility)
  - SafeQueryResult.isConnectionError distinguishes database-down from other errors
  - Sentry.captureException with tags and extra context for better error tracking
---
