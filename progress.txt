# Ralph Progress Log
Started: Sat 10 Jan 2026 02:10:52 +04

## Codebase Patterns
- Use Claude Haiku (claude-3-5-haiku-20241022) for fast/cheap LLM operations like classification
- Use Claude Sonnet for higher quality operations (reconciliation, complex analysis)
- Types belong in /lib/types/ directory
- Pre-existing type errors may exist in app/brief/[id]/page.tsx - use explicit type casts for JSONB fields
- FixerType enum uses camelCase (e.g., FixerType.firstPrinciplesCoherence, not FirstPrinciplesCoherence)
- Fixer subclass pattern: extend BaseFixer, set fixerType & description, implement buildPrompt(input)

---

## 2026-01-10 11:15 - US-001
Thread: https://ampcode.com/threads/T-019ba4d0-04d6-7331-bbb7-29dc7127c80f
- Created /lib/types/refinement.ts with all fixer agent types
- Defined FixerType enum with 7 dimensions (firstPrinciplesCoherence, internalConsistency, evidenceQuality, accessibility, objectivity, factualAccuracy, biasDetection)
- Defined SuggestedEdit, FixerResult, RefinementAttempt, RefinementResult, FixerInput, DimensionScores, ConsensusResult, ReconciliationResult interfaces
- Fixed pre-existing type errors in app/brief/[id]/page.tsx (implicit any types in map callbacks)
- Files changed: lib/types/refinement.ts (new), app/brief/[id]/page.tsx (fixes)
- **Learnings for future iterations:**
  - JSONB fields from Supabase need explicit type casts (e.g., `as Record<string, number>`)
  - brief.sources, brief.clarity_critique.breakdown, etc. need explicit types in .map()
  - Always run `npm run build` to catch type errors before committing
---

## 2026-01-10 11:30 - US-002
Thread: https://ampcode.com/threads/T-019ba4d4-6eb5-7392-a2b5-073f86b99111
- Created /lib/agents/fixers/base-fixer.ts with abstract BaseFixer class
- Implemented suggestEdits method returning Promise<FixerResult>
- Added retry wrapper with exponential backoff (3 retries, 1s/2s/4s delays)
- Common logic: prompt building, LLM call with Claude Haiku, JSON response parsing
- System prompt template for fixer agents with standardized response format
- Subclasses must implement: buildPrompt(input) and fixerType/description properties
- Files changed: lib/agents/fixers/base-fixer.ts (new)
- **Learnings for future iterations:**
  - No existing retry-wrapper.ts exists; created inline withRetry function in base-fixer
  - Use @anthropic-ai/sdk for LLM calls (already installed in project)
  - Fixer agents directory structure: /lib/agents/fixers/
  - Response parsing extracts JSON from LLM response using regex (Claude sometimes adds text)
---

## 2026-01-10 12:00 - US-003
Thread: https://ampcode.com/threads/T-019ba4d6-7d6e-72bf-803d-0e442331c197
- Created /lib/agents/fixers/first-principles-fixer.ts extending BaseFixer
- Prompt focuses on: gaps in logical chain, unstated assumptions, incomplete reasoning, foundation clarity
- Files changed: lib/agents/fixers/first-principles-fixer.ts (new)
- **Learnings for future iterations:**
  - FixerType enum uses camelCase (e.g., firstPrinciplesCoherence, not FirstPrinciplesCoherence)
  - Pattern for fixer subclasses: implement fixerType, description, and buildPrompt(input)
---
